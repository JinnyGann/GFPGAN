name: Build GFPGAN Executable

# This tells GitHub to show a button to run this workflow manually
on:
  workflow_dispatch:

jobs:
  build-windows:
    runs-on: windows-latest  # Use a fresh Windows machine

    steps:
    # 1. Get the source code from your fork
    - name: Checkout repository
      uses: actions/checkout@v3
      with:
        submodules: 'recursive' # Important: this gets the ncnn dependency

    # 2. Install the Vulkan SDK (required for compiling)
    - name: Install Vulkan SDK
      uses: humblebee/install-vulkan-sdk@v1.2
      with:
        version: '1.3.216.0' # A specific, stable version of the SDK

    # 3. Setup MSVC (Visual Studio) build tools
    - name: Setup MSVC
      uses: microsoft/setup-msbuild@v1.1

    # 4. Configure the project using CMake
    - name: Configure CMake
      run: cmake -S . -B build -DGFPGAN_BUILD_NCNN_VULKAN=ON

    # 5. Compile the code and create the .exe
    - name: Build with MSBuild
      run: |
        cd build
        msbuild GFPGAN.sln /p:Configuration=Release /p:Platform=x64

    # 6. Find the .exe and package it for download
    - name: Upload Artifact
      uses: actions/upload-artifact@v3
      with:
        name: gfpgan-ncnn-vulkan-windows
        path: |
          build/Release/gfpgan-ncnn-vulkan.exe
          models/ # Also include the models folder for convenience
